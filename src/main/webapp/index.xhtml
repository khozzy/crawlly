<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Crawler</title>
    <h:outputStylesheet library="css" name="bootstrap.css" />
    <h:outputScript library="js" name="jquery-2.0.3.js" />
    <h:outputScript library="js" name="bootstrap.js" />
</h:head>

<h:body>

    <ui:composition template="template/commonLayout.xhtml">
        <ui:define name="content">

            <style type="text/css">
                div.dataTables_length label {
                    width: 460px;
                    float: left;
                    text-align: left;
                }

                div.dataTables_length select {
                    width: 75px;
                }

                div.dataTables_filter label {
                    float: right;
                    /*width: 460px;*/
                }

                div.dataTables_info {
                    padding-top: 8px;
                }

                div.dataTables_paginate {
                    float: right;
                    margin: 0;
                }

                table {
                    margin: 1em 0;
                    clear: both;
                }
            </style>

            <f:view>

                <h:form>
                    <p:poll id="queue_poll" interval="1" update=":queue:seedPages, :form:seedPagesTable, :queue:currentStatus"/>
                </h:form>

                <h:form id="form">
                    <div class="row">
                        <div class="span3">
                            <h3><h:outputText value="Seed Pages" /></h3>
                        </div>

                        <div style="float: right">
                            <h:commandButton action="#{seedPageController.createSeedPage}" value="New seed page" styleClass="btn btn-warning"/>
                        </div>
                    </div>

                    <h:dataTable value="#{seedPageController.seedPages}"
                                 var="dataTableItem"
                                 styleClass="table table-condensed table-hover table-bordered"
                                 id="seedPagesTable">
                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="ID" />
                            </f:facet>

                            <h:outputText value="#{dataTableItem.id}" />
                        </h:column>

                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="URL" />
                            </f:facet>

                            <h:outputLink value="#{dataTableItem.url}">#{dataTableItem.url}</h:outputLink>
                        </h:column>

                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="Last fetch">

                                </h:outputText>
                            </f:facet>

                            <h:outputText value="#{dataTableItem.fetchDate}" />
                        </h:column>

                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="Sub Pages" />
                            </f:facet>

                            <h:outputText value="#{seedPageController.getSubPagesCount(dataTableItem)}" />
                        </h:column>

                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="Action" />
                            </f:facet>

                            <h:commandButton action="#{queueController.addSeedPageToQueue(dataTableItem)}" value="Add to queue" rendered="#{not queueController.isSeedPageInQueue(dataTableItem)}" styleClass="btn btn-small btn-info"/>
                        </h:column>
                    </h:dataTable>

                </h:form>
            </f:view>

            <h:outputScript library="js" name="datatables-1.9.4.min.js" />
            <h:outputScript library="js" name="paging.js" />

            <script type="text/javascript">

                $(document).ready(function() {
                    $("#form\\:seedPagesTable").dataTable({
                        "sDom": "&lt;'row'&lt;'span4'l&gt;&lt;'span8'f&gt;r&gt;t&lt;'row'&lt;'span8'i&gt;&lt;'span8'p&gt;&gt;",
                        "sPaginationType": "bootstrap"
                    });
                });

                $.extend( $.fn.dataTableExt.oStdClasses, {
                    "sSortAsc": "header headerSortDown",
                    "sSortDesc": "header headerSortUp",
                    "sSortable": "header"
                } );
            </script>

        </ui:define>
    </ui:composition>



</h:body>
</html>
